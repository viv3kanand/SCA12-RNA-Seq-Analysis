---
title: "Figures"
author: "viv3kanand"
date: "2023-05-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Load packages
```{r}
require(ggplot2)
theme_set(theme_minimal())
require(ggpubr)
require(tidyverse)
require(patchwork)
```

### Load datasets
```{r}
source("../scripts/helper_scripts.R")

se <- readRDS("RData/se.rds")
gse <- readRDS("RData/gse.rds")
se_out <- readRDS("RData/se_out.rds")
gse_out <- readRDS("RData/gse_out.rds")
dds <- readRDS("RData/dds.rds")
vst_mat <- readRDS("RData/vst_bc.rds")
```

### PCA of Batch effect corrected and uncorrected samples
```{r}
li <- list("Uncorrected" = dds, "Corrected" = vst_mat)
purrr::imap(li, function(obj, name){
  if (name == "Uncorrected"){
    call_PCA(obj) %>% 
      augment(as.data.frame(colData(dds))) %>%
      ggplot(aes(x=.fittedPC1, y=.fittedPC2, color=Condition, shape = Cell_line)) + 
      geom_point(size = 3) + 
      geom_text(aes(label = Batch), hjust=0, vjust=0) +
      xlab(paste0("PC1: ",round(percentVar[1] * 100),"% variance")) +
      ylab(paste0("PC2: ",round(percentVar[2] * 100),"% variance")) +
      coord_fixed() -> P1
    }
  else {
    call_PCA(obj) %>% 
      augment(as.data.frame(colData(dds))) %>%
      ggplot(aes(x=.fittedPC1, y=.fittedPC2, color=Condition, shape = Cell_line)) + 
      geom_point(size = 3) + 
      geom_text(aes(label = Batch), hjust=0, vjust=0) +
      xlab(paste0("PC1: ",round(percentVar[1] * 100),"% variance")) +
      ylab(paste0("PC2: ",round(percentVar[2] * 100),"% variance")) +
      coord_fixed() -> P2
    }
  P1 + P2
  })

pca <- call_PCA(vst_mat)

percentVar <- pca$sdev^2 / sum( pca$sdev^2 )

# Scree plot
data.frame(Components = paste0("PC",seq_len(5)), 
           value = percentVar[1:5]) %>% 
  ggplot(aes(x = Components, y = value)) + 
  geom_col(fill = "#b6dfe2") + 
  ylab("% of total variance")

```

### 
```{r}

```



















